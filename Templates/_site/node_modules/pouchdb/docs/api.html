<h1 id='api_reference'>API Reference</h1>

<p>Most of the PouchDB API is exposed as <code>fun(arg, [options], [callback])</code> Where both the options and the callback are optional. Callbacks use the <code>function(err, result)</code> idiom where the first argument will be undefined unless there is an error, the second argument holds the result.</p>

<h2 id='create_database'>Create database<a id='create_database' /></h2>
<div>
  <pre><code class='js'>new PouchDB([name], [options])</code></pre>
</div>
<p>This method creates a database or opens an existing one. If you use a <code>http://domain.com/dbname</code> then PouchDB will work as a client to an online CouchDB instance, otherwise it will create a local database using a backend that is present.</p>

<p><strong>Note:</strong> If you are also using indexedDB directly, PouchDB will use <code>_pouch_</code> to prefix the internal database names, dont manually create databases with the same prefix.</p>

<ul>
<li><code>options.name</code>: You can omit the name argument and specify it via options.</li>

<li><code>options.auto_compaction</code>: This turns on auto compaction (experimental).</li>
</ul>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>var db = new PouchDB('dbname');
// or
var db = new PouchDB('http://localhost:5984/dbname');</code></pre>
</div>
<h2 id='delete_database'>Delete database<a id='delete_database' /></h2>
<div>
  <pre><code class='js'>PouchDB.destroy(name, [callback])</code></pre>
</div>
<p>Delete database with given name</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>PouchDB.destroy('dbname', function(err, info) { });</code></pre>
</div>
<h2 id='create__update_a_document'>Create / Update a document<a id='create_document' /></h2>
<div>
  <pre><code class='js'>db.put(doc, [options], [callback])</code></pre>
</div>
<p>Create a new document or update an existing document. If the document already exists you must specify its revision <code>_rev</code>, otherwise a conflict will occur.</p>

<p>There are some restrictions on valid property names of the documents, these are explained <a href='http://wiki.apache.org/couchdb/HTTP_Document_API#Special_Fields'>here</a>.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.put({
  _id: 'mydoc',
  title: 'Heroes'
}, function(err, response) { });

db.put({
  _id: 'mydoc',
  _rev: '1-A6157A5EA545C99B00FF904EEF05FD9F',
  title: 'Lets Dance',
}, function(err, response) { })</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;ok&quot;: true,
  &quot;id&quot;: &quot;mydoc&quot;,
  &quot;rev&quot;: &quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;
}</code></pre>
</div>
<h2 id='fetch_document'>Fetch document<a id='fetch_document' /></h2>
<div>
  <pre><code class='js'>db.get(docid, [options], [callback])</code></pre>
</div>
<p>Retrieves a document, specified by <code>docid</code>.</p>

<ul>
<li><code>options.rev</code>: Fetch specific revision of a document. Defaults to winning revision (see <a href='http://guide.couchdb.org/draft/conflicts.html'>couchdb guide</a>.</li>

<li><code>options.revs</code>: Include revision history of the document</li>

<li><code>options.revs_info</code>: Include a list of revisions of the document, and their availability.</li>

<li><code>options.open_revs</code>: Fetch all leaf revisions if open_revs=&#8221;all&#8221; or fetch all leaf revisions specified in open_revs array. Leaves will be returned in the same order as specified in input array</li>

<li><code>options.conflicts</code>: If specified conflicting leaf revisions will be attached in <code>_conflicts</code> array</li>

<li><code>options.attachments</code>: Include attachment data</li>

<li><code>options.local_seq</code>: Include sequence number of the revision in the database</li>
</ul>
<span />
<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.get('mydoc', function(err, doc) { });</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;title&quot;: &quot;Rock and Roll Heart&quot;,
  &quot;_id&quot;: &quot;mydoc&quot;,
  &quot;_rev&quot;: &quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;
}</code></pre>
</div>
<h2 id='delete_document'>Delete document<a id='delete_document' /></h2>
<div>
  <pre><code class='js'>db.remove(doc, [options], [callback])</code></pre>
</div>
<p>Delete a document, <code>doc</code> is required to be a document with at least an <code>_id</code> and a <code>_rev</code> property, sending the full document will work.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.get('mydoc', function(err, doc) {
  db.remove(doc, function(err, response) { });
});</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;ok&quot;: true,
  &quot;id&quot;: &quot;mydoc&quot;,
  &quot;rev&quot;: &quot;2-9AF304BE281790604D1D8A4B0F4C9ADB&quot;
}</code></pre>
</div>
<h2 id='create_a_batch_of_documents'>Create a batch of documents<a id='batch_create' /></h2>
<div>
  <pre><code class='js'>db.bulkDocs(docs, [options], [callback])</code></pre>
</div>
<p>Modify, create or delete multiple documents. The docs argument is an object with property <code>docs</code> which is an array of documents. You can also specify a <code>new_edits</code> property on the <code>docs</code> object that when set to <code>false</code> allows you to post <a href='http://wiki.apache.org/couchdb/HTTP_Bulk_Document_API#Posting_Existing_Revisions'>existing documents</a>.</p>

<p>If you omit an <code>_id</code> parameter on a given document, the database will create a new document and assign an ID for you. To update a document you must include both an <code>_id</code> parameter and a <code>_rev</code> parameter, which should match the ID and revision of the document on which to base your updates. Finally, to delete a document, include a <code>_deleted</code> parameter with the value <code>true</code>.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.bulkDocs({docs: [{title: 'Lisa Says'}]}, function(err, response) { });</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>[{
  &quot;ok&quot;: true,
  &quot;id&quot;: &quot;828124B9-3973-4AF3-9DFD-A94CE4544005&quot;,
  &quot;rev&quot;: &quot;1-A8BC08745E62E58830CA066D99E5F457&quot;
}]</code></pre>
</div>
<h2 id='fetch_documents'>Fetch documents<a id='batch_fetch' /></h2>
<div>
  <pre><code class='js'>db.allDocs([options], [callback])</code></pre>
</div>
<p>Fetch multiple documents, deleted document are only included if <code>options.keys</code> is specified.</p>

<ul>
<li><code>options.include_docs</code>: Include the document in each row in the <code>doc</code> field - <code>options.conflicts</code>: Include conflicts in the <code>_conflicts</code> field of a doc</li>

<li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get documents with keys in a certain range</li>

<li><code>options.descending</code>: Reverse the order of the output table</li>

<li><code>options.keys</code>: array of keys you want to get - neither <code>startkey</code> nor <code>endkey</code> can be specified with this option - the rows are returned in the same order as the supplied &#8220;keys&#8221; array - the row for a deleted document will have the revision ID of the deletion, and an extra key &#8220;deleted&#8221;:true in the &#8220;value&#8221; property - the row for a nonexistent document will just contain an &#8220;error&#8221; property with the value &#8220;not_found&#8221;</li>

<li><code>options.attachments</code>: Include attachment data</li>
</ul>
<span />
<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.allDocs({include_docs: true}, function(err, response) { });</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;total_rows&quot;: 1,
  &quot;rows&quot;: [{
    &quot;doc&quot;: {
      &quot;_id&quot;: &quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;,
      &quot;_rev&quot;: &quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;,
      &quot;blog_post&quot;: &quot;my blog post&quot;
    },
   &quot;id&quot;: &quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;,
   &quot;key&quot;: &quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;,
   &quot;value&quot;: {
    &quot;rev&quot;: &quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;
   }
 }]
}</code></pre>
</div>
<h2 id='listen_to_database_changes'>Listen to database changes<a id='changes' /></h2>
<div>
  <pre><code class='js'>db.changes(options)</code></pre>
</div>
<p>A list of changes made to documents in the database, in the order they were made. If <code>options.continuous</code> is set it returns object with one method <code>cancel</code> which you call if you don&#8217;t want to listen to new changes anymore. <code>opttions.onChange</code> will be be called for each change that is encountered.</p>

<ul>
<li><code>options.include_docs</code>: Include the associated document with each change</li>

<li><code>options.conflicts</code>: Include conflicts</li>

<li><code>options.descending</code>: Reverse the order of the output table</li>

<li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates</li>

<li><code>options.since</code>: Start the results from the change immediately after the given sequence number</li>

<li><code>options.complete</code>: Function called when all changes have been processed</li>

<li><code>options.continuous</code>: Use <em>longpoll</em> feed</li>

<li><code>options.onChange</code>: Function called on each change after deduplication (only sends the most recent for each document), not called as a callback but called as onChange(change). Use with <code>continuous</code> flag. If you want to</li>
</ul>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>var changes = db.changes({
  since: 20,
  continuous: true,
  onChange: function(change) { }
});

changes.cancel();</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;id&quot;:&quot;somestuff&quot;,
  &quot;seq&quot;:21,
  &quot;changes&quot;:[{
    &quot;rev&quot;:&quot;1-8e6e4c0beac3ec54b27d1df75c7183a8&quot;
  }],
  &quot;doc&quot;:{
    &quot;value&quot;:&quot;somevalue&quot;,
    &quot;_id&quot;:&quot;somestuff&quot;,
    &quot;_rev&quot;:&quot;1-8e6e4c0beac3ec54b27d1df75c7183a8&quot;
  }
}</code></pre>
</div>
<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.changes({complete: function(err, response) { }});</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;results&quot;: [{
    &quot;id&quot;: &quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;,
    &quot;seq&quot;: 1,
    &quot;changes&quot;: [{
      &quot;rev&quot;: &quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;
    }]
  }, {
    &quot;id&quot;: &quot;mydoc&quot;,
    &quot;seq&quot;: 2,
    &quot;changes&quot;: [{
      &quot;rev&quot;: &quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;
    }]
  }, {
    &quot;id&quot;: &quot;otherdoc&quot;,
    &quot;seq&quot;: 3,
    &quot;changes&quot;: [{
      &quot;rev&quot;: &quot;1-3753476B70A49EA4D8C9039E7B04254C&quot;
    }]
  }, {
    &quot;id&quot;: &quot;828124B9-3973-4AF3-9DFD-A94CE4544005&quot;,
    &quot;seq&quot;: 4,
    &quot;changes&quot;: [{
      &quot;rev&quot;: &quot;1-A8BC08745E62E58830CA066D99E5F457&quot;
    }]
  }]
}</code></pre>
</div>
<h2 id='replicate_a_database'>Replicate a database<a id='replication' /></h2>
<div>
  <pre><code class='js'>Pouch.replicate(source, target, [options])</code></pre>
</div>
<p>Replicate data from <code>source</code> to <code>target</code>, both the <code>source</code> and <code>target</code> can be strings used to represent a database of a PouchDB object. If <code>options.continuous</code> is <code>true</code> then this will track future changes and also replicate them.</p>

<p>If you want to sync data in both directions you can call this twice reversing the <code>source</code> and <code>target</code> arguments.</p>

<ul>
<li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates.</li>

<li><code>options.complete</code>: Function called when all changes have been processed.</li>

<li><code>options.onChange</code>: Function called on each change processed..</li>

<li><code>options.continuous</code>: If true starts subscribing to future changes in the <code>source</code> database and continue replicating them.</li>
</ul>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>Pouch.replicate('mydb', 'http://localhost:5984/mydb', {
  onChange: onChange,
  complete: onComplete
});;</code></pre>
</div>
<p>There are also shorthands for replication given existing PouchDB objects, these behave the same as <code>Pouch.replicate()</code>:</p>
<div>
  <pre><code class='js'>db.replicate.to(remoteDB, [options]);
// or
db.replicate.from(remoteDB, [options]);</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  'ok': true,
  'docs_read': 2,
  'docs_written': 2,
  'start_time': &quot;Sun Sep 23 2012 08:14:45 GMT-0500 (CDT)&quot;,
  'end_time': &quot;Sun Sep 23 2012 08:14:45 GMT-0500 (CDT)&quot;
}</code></pre>
</div>
<h2 id='save_an_attachment'>Save an attachment<a id='save_attachment' /></h2>
<div>
  <pre><code class='js'>db.putAttachment(docId, attachmentId, rev, doc, type, [callback]);</code></pre>
</div>
<p>Attaches a binary object to a document, most of PouchDB&#8217;s API deals with JSON however we often need to store binary data, these are called <code>attachments</code> and you can attach any binary data to a document.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>var doc = new Blob([&quot;It's a God awful small affair&quot;]);
db.putAttachment('a', 'text', rev, doc, 'text/plain', function(err, res) {})</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;ok&quot;: true,
  &quot;id&quot;: &quot;otherdoc&quot;,
  &quot;rev&quot;: &quot;2-068E73F5B44FEC987B51354DFC772891&quot;
}</code></pre>
</div>
<p>Within node you must use a Buffer:</p>
<div>
  <pre><code class='js'>var doc = new Buffer(&quot;It's a God awful small affair&quot;);</code></pre>
</div>
<h3 id='save_an_inline_attachment'>Save an inline attachment</h3>

<p>You can inline attachments inside the document. In this case the attachment data must be supplied as a base64 encoded string:</p>
<div>
  <pre><code class='js'>{
  '_id': 'otherdoc',
  'title': 'Legendary Hearts',
  '_attachments': {
    &quot;text&quot;: {
      &quot;content_type&quot;: &quot;text/plain&quot;,
       &quot;data&quot;: &quot;TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKT&quot; +
         &quot;WFrZSBvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA==&quot;
    }
  }
}</code></pre>
</div>
<p>See <a href='http://wiki.apache.org/couchdb/HTTP_Document_API#Inline_Attachments'>Inline Attachments</a> on the CouchDB Wiki.</p>

<h2 id='get_an_attachment'>Get an attachment<a id='get_attachment' /></h2>
<div>
  <pre><code class='js'>db.getAttachment(docId, attachmentId, [opts], [callback])</code></pre>
</div>
<p>Get attachment data.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.getAttachment('otherdoc', 'text', function(err, res) { });</code></pre>
</div>
<p>In node you get Buffers and Blobs in the browser.</p>

<h3 id='inline_attachments'>Inline attachments</h3>

<p>You can specify <code>attachments: true</code> to most read operations, the attachment data will then be included in the result.</p>

<h2 id='delete_an_attachment'>Delete an attachment<a id='delete_attachment' /></h2>
<div>
  <pre><code class='js'>db.removeAttachment(docId, attachmentId, rev, [callback])</code></pre>
</div>
<p>Delete an attachment from a doc.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.removeAttachment('otherdoc',
                    'text',
                    '2-068E73F5B44FEC987B51354DFC772891',
                    function(err, res) { });</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;ok&quot;: true,
  &quot;rev&quot;: &quot;3-1F983211AB87EFCCC980974DFC27382F&quot;
}</code></pre>
</div>
<h2 id='query_the_database'>Query the database<a id='query_database' /></h2>
<div>
  <pre><code class='js'>db.query(fun, [options], [callback])</code></pre>
</div>
<p>Retrieve a view, this allows you to perform more complex queries on PouchDB, the <a href='http://docs.couchdb.org/en/latest/ddocs.html#view-functions'>CouchDB documentation for map reduce</a> applies to PouchDB.</p>

<ul>
<li><code>fun</code>: Name of a view function or function</li>

<li><code>options.reduce</code>: Reduce function</li>
</ul>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>function map(doc) {
  if(doc.title) {
    emit(doc.title, null);
  }
}

db.query({map: map}, {reduce: false}, function(err, response) { });</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;rows&quot;: [{
    &quot;id&quot;: &quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;,
    &quot;key&quot;: &quot;Cony Island Baby&quot;,
    &quot;value&quot;: null
  }, {
    &quot;id&quot;: &quot;otherdoc&quot;,
    &quot;key&quot;: &quot;Legendary Hearts&quot;,
    &quot;value&quot;: null
  }, {
    &quot;id&quot;: &quot;828124B9-3973-4AF3-9DFD-A94CE4544005&quot;,
    &quot;key&quot;: &quot;Lisa Says&quot;,
    &quot;value&quot;: null
  }, {
    &quot;id&quot;: &quot;mydoc&quot;,
    &quot;key&quot;: &quot;Rock and Roll Heart&quot;,
    &quot;value&quot;: null
  }]
}</code></pre>
</div>
<h2 id='get_database_information'>Get database information<a id='database_information' /></h2>
<div>
  <pre><code class='js'>db.info(callback)</code></pre>
</div>
<p>Get information about a database.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.info(function(err, info) { })</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;db_name&quot;: &quot;test&quot;,
  &quot;doc_count&quot;: 4,
  &quot;update_seq&quot;: 5
}</code></pre>
</div>
<h2 id='compact_the_database'>Compact the database<a id='compaction' /></h2>
<div>
  <pre><code class='js'>db.compact([opts], [callback])</code></pre>
</div>
<p>Runs compaction of the database. Fires callback when compaction is done. If you use http adapter and have specified callback Pouch will ping the remote database in regular intervals unless the compaction is finished.</p>

<ul>
<li><code>options.interval</code>: Number of milliseconds Pouch waits before asking again if compaction is already done. Only for http adapter.</li>
</ul>

<h2 id='document_revisions_diff'>Document Revisions Diff<a id='revisions_diff' /></h2>
<div>
  <pre><code class='js'>db.revsDiff(diff, [callback])</code></pre>
</div>
<p>Given a set of document/revision IDs, returns the subset of those that do not correspond to revisions stored in the database. Primarily used in replication.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>db.revsDiff({
  myDoc1: [
    &quot;1-b2e54331db828310f3c772d6e042ac9c&quot;,
    &quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;
  ]
}, function (err, diffs) { });</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>{
  &quot;myDoc1&quot;: {
    &quot;missing&quot;: [&quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;]
  }
}</code></pre>
</div>
<h2 id='list_all_databases'>List all databases<a id='list_databasese' /></h2>
<div>
  <pre><code class='js'>Pouch.allDbs(callback)</code></pre>
</div>
<p>Retrieves all databases from PouchDB. By default, this feature is turned off and this function will return an empty list. To enable this feature and obtain a list of all the databases, set <code>Pouch.enableAllDbs</code> to true before creating any databases.</p>

<h4 id='example_usage'>Example Usage:</h4>
<div>
  <pre><code class='js'>Pouch.enableAllDbs = true;
Pouch.allDbs(function(err, response) {});</code></pre>
</div>
<h4 id='example_response'>Example Response:</h4>
<div>
  <pre><code class='js'>[
  &quot;testdb&quot;
]</code></pre>
</div>